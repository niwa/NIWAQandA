/*! NIWAQandA 14-03-2016 */
var qanda=angular.module("qanda",[]);qanda.controller("qandaController",["$scope","qandaService","$sce",function(a,b){a.model={headlineIds:[],nodeListRaw:[],nodeListSorted:[]},a.$watch("model.headlineIds",function(c){"undefined"!=typeof c&&0!==c.length&&b.getNodes(c).then(function(b){a.model.nodeListSorted=b})}),a.getLatestNodes=function(){b.getLatestNodeIds().then(function(b){a.model.headlineIds=b},function(){a.model.nodeListSorted=!1})}}]),qanda.directive("qanda",[function(){function a(a){a.getLatestNodes()}return{restrict:"E",link:a,template:'<div id="niwaQndA" class="panel panel-primary"><div class="panel-heading"><h1 class="panel-title">NIWA Q&amp;A </h1></div><div ng-repeat="node in model.nodeListSorted" class="body"><img width="100%" ng-show="$index==0" ng-src="{{node.nodeImage}}" /><h3>{{node.title }}</h3><h4>Question</h4><p ng-bind-html="node.question | markup"></p><h4>Answer</h4><p ng-bind-html="node.answer | markup"></p></div></div></div></div>',controller:"qandaController",scope:!1}}]),qanda.filter("markup",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),qanda.service("qandaModelService",[function(){return{get:function(a){var b={};return b.contentType="forecast_faq",b.imageBaseUrl="http://content-test.niwa.co.nz/sites/default/files/",b.headlinesUrl="http://content-test.niwa.co.nz/content/resource_list_by_type/"+b.contentType,b.nodeUrl="http://content-test.niwa.co.nz/content/node/",b.nodesAmount=10,"undefined"!=typeof b[a]?b[a]:"invalid parameter request"}}}]),qanda.service("qandaService",["$http","$q","$sce","qandaModelService",function(a,b,c,d){return{getLatestNodeIds:function(){var c=b.defer();return a({method:"GET",url:d.get("headlinesUrl")}).then(function(a){for(var b=a.data.titles.length,d=[],e=0;b>e;e++)d.push(a.data.titles[e].nid);c.resolve(d)},function(a){return"http  error"}),c.promise},getNodes:function(c){for(var e=function(a,b){return b.created-a.created},f=b.defer(),g=c.length<=10?c.length:10,h=1,i=[],j=0;g>j;j++)a({method:"GET",url:d.get("nodeUrl")+c[j]}).then(function(a){var b={nid:a.data.nid,created:a.data.created,title:a.data.title,question:a.data.field_question.und[0].value,answer:a.data.field_answer.und[0].value};h++,i.push(b),h>=g&&f.resolve(i.sort(e))},function(){return"http error"});return f.promise}}}]);